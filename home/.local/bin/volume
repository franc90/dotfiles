#!/bin/bash

function get_volume() {
  pulsemixer --get-volume | awk '{print $1}'
}

icon_prefix="/usr/share/icons/Numix/48/notifications/"
high_vol_icon="${icon_prefix}notification-audio-volume-high.svg"
low_vol_icon="${icon_prefix}notification-audio-volume-low.svg"
med_vol_icon="${icon_prefix}notification-audio-volume-medium.svg"
muted_icon="${icon_prefix}notification-audio-volume-muted.svg"

function send_notification() {
  if [ "$(pulsemixer --get-mute)" -eq "1" ]; then
    dunstify -a "changeVolume"\
      -h string:x-canonical-private-synchronous:audio "Muted" \
      -t 1500 \
      -h int:value:"$volume" \
      --icon "${muted_icon}"
    return
  fi

  let volume=$(get_volume)
  if [ "$volume" -lt "40" ]; then
    dunstify -a "changeVolume" \
      -t 1500 \
      -h string:x-canonical-private-synchronous:audio "Volume:" \
      -h int:value:"$volume" \
      --icon "${low_vol_icon}"
  elif [ "$volume" -lt "80" ]; then
    dunstify -a "changeVolume" \
      -t 1500 \
      -h string:x-canonical-private-synchronous:audio "Volume:" \
      -h int:value:"$volume" \
      --icon "${med_vol_icon}"
  else
    dunstify -a "changeVolume" \
      -t 1500 \
      -h string:x-canonical-private-synchronous:audio "Volume:" \
      -h int:value:"$volume" \
      --icon "$high_vol_icon"
  fi
}

case $1 in
  up)
    # Set the volume on (if it was muted)
    pulsemixer --unmute
    pulsemixer --change-volume +5
    send_notification
    ;;
  down)
    # Set the volume on (if it was muted)
    pulsemixer --unmute
    pulsemixer --change-volume -5
    if [ "$(get_volume)" -eq "0" ]; then
        pulsemixer --mute
    fi
    send_notification
    ;;
  mute)
    pulsemixer --toggle-mute
    send_notification
    ;;
esac
